<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <title>엔트리 TTS 만들기</title>
    <style>
        fieldset {
            border: 1px black solid;
        }

        legend {
            font-size: 25px;
        }

        #url,
        #copyalert {
            outline: 0px;
        }

        * {
            font-family: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
        }
    </style>
</head>

<body>
    <h1><span style="text-decoration: line-through; font-size: 15px;">디자인 따위는 개나 줘버린</span>엔트리 TTS 만드는 사이트</h1>
    <hr>
    <fieldset>
        <legend>속도</legend>
        <input type="radio" name="speed" value="-5">매우 매우 빠르게<br>
        <input type="radio" name="speed" value="-4">매우 빠르게<br>
        <input type="radio" name="speed" value="-3">빠르게<br>
        <input type="radio" name="speed" value="-2">조금 빠르게<br>
        <input type="radio" name="speed" value="-1">매우 조금 빠르게<br>
        <input type="radio" name="speed" value="0" checked>보통<br>
        <input type="radio" name="speed" value="1">매우 조금 느리게<br>
        <input type="radio" name="speed" value="2">조금 느리게<br>
        <input type="radio" name="speed" value="3">느리게<br>
        <input type="radio" name="speed" value="4">매우 느리게<br>
        <input type="radio" name="speed" value="5">매우 매우 느리게<br>
        <input type="radio" name="speed" value="other"><input type="text" id="speed" placeholder="기타"
            onInput="otherinput(0)">
    </fieldset>
    <fieldset>
        <legend>목소리</legend>
        <input type="radio" name="voice" value="kyuri" checked>여성<br>
        <input type="radio" name="voice" value="jinho">남성<br>
        <input type="radio" name="voice" value="hana">친절한<br>
        <input type="radio" name="voice" value="dinna">감미로운<br>
        <input type="radio" name="voice" value="brown">울리는<br>
        <input type="radio" name="voice" value="minions">장난스러운<br>
        <input type="radio" name="voice" value="sally">앙증맞은<br>
        <input type="radio" name="voice" value="nsabina">마녀<br>
        <input type="radio" name="voice" value="nmammon">악마<br>
        <input type="radio" name="voice" value="nmeow">야옹이<br>
        <input type="radio" name="voice" value="nwoof">멍멍이<br>
        <input type="radio" name="voice" value="other"><input type="text" id="voice" placeholder="기타"
            onInput="otherinput(1)">
    </fieldset>
    <fieldset>
        <legend>음높이</legend>
        <input type="radio" name="pitch" id="-5" value="-5">매우 매우 높게<br>
        <input type="radio" name="pitch" id="-4" value="-4">매우 높게<br>
        <input type="radio" name="pitch" id="-3" value="-3">높게<br>
        <input type="radio" name="pitch" id="-2" value="-2">조금 높게<br>
        <input type="radio" name="pitch" id="-1" value="-1">매우 조금 높게<br>
        <input type="radio" name="pitch" id="0" value="0" checked>보통<br>
        <input type="radio" name="pitch" id="-1" value="1">매우 조금 낮게<br>
        <input type="radio" name="pitch" id="-2" value="2">조금 낮게<br>
        <input type="radio" name="pitch" id="-3" value="3">낮게<br>
        <input type="radio" name="pitch" id="-4" value="4">매우 낮게<br>
        <input type="radio" name="pitch" id="-5" value="5">매우 매우 낮게<br>
        <input type="radio" name="pitch" value="other"><input type="text" id="pitch" placeholder="기타"
            onInput="otherinput(2)">
        <br>
    </fieldset>
    <fieldset>
        <legend>텍스트</legend>
        <input type="text" id="text" placeholder="Hello World" style="width: 30%;"
            onkeyup="automode == 0 ? (event.keyCode == 13 ? gen() : null) : gen()">
        <br>
    </fieldset>
    <input type="button" value="만들기" style="margin-top: 10px;" onclick="gen()">
    <input type="button" value="오토 모드 (꺼짐)" style="margin-top: 10px;" onclick="automodefun(this)">
    <input type="text" id="copyalert" style="width: 80%; display:none;" readonly value='복사되었습니다'>
    <input type="text" id="url" style="width: 80%;" readonly onclick="copyurl(this.value)">
    <input type="button" value="결과 복사" onclick="copyshare()">
    <script>
        let automode = 0
        function automodefun(my) {
            if (automode == 0) {
                my.value = "오토 모드 (켜짐)"
                automode = 1
                document.querySelector('#text').placeholder = "오토 모드에서는 텍스트를 입력하기만 해도 만들어집니다"
                document.querySelector('#text').value = ""
            } else {
                my.value = "오토 모드 (꺼짐)"
                automode = 0
                document.querySelector('#text').placeholder = "Hello World"
                document.querySelector('#text').value = ""
            }
        }
        function gen() {
            !document.querySelector('#text').value ? document.querySelector('#text').value = document.querySelector('#text').placeholder : null
            document.querySelector('#url').value = `https://playentry.org/api/expansionBlock/tts/read.mp3?text=${encodeURI(document.querySelector('#text').value.replaceAll('#', "%23").replaceAll('&', "%26"))}&speed=${document.querySelector('input[name="speed"]:checked').value == "other" ? document.querySelector('#speed').value : document.querySelector('input[name="speed"]:checked').value}&pitch=${document.querySelector('input[name="pitch"]:checked').value == "other" ? document.querySelector('#pitch').value : document.querySelector('input[name="pitch"]:checked').value}&speaker=${document.querySelector('input[name="voice"]:checked').value == "other" ? document.querySelector('#voice').value : document.querySelector('input[name="voice"]:checked').value}`
            try { document.querySelector('audio').remove() } catch { }
            let song = document.createElement('audio')
            let songurl = document.createElement('source')
            song.controls = "true"
            song.style.width = "80%"
            song.style.marginTop = "10px"
            song.style.display = "block"
            songurl.src = document.querySelector('#url').value
            document.body.appendChild(song)
            document.querySelector('audio').appendChild(songurl)
            automode == 1 ? document.querySelector('audio').play() : null
        }
        function copyurl(url) {
            url = "" ? navigator.clipboard.writeText("아무 것도 없는 값을 복사하시려는 이유가 뭔가요? 신기하네요") : navigator.clipboard.writeText(url)
            document.querySelector('#copyalert').style.display = "inline"
            document.querySelector('#url').style.display = "none"
            setTimeout(() => {
                document.querySelector('#copyalert').style.display = "none"
                document.querySelector('#url').style.display = "inline"
            }, 1000)
        }
        function copyshare() {
            navigator.clipboard.writeText(`https://firerun.kro.kr/entrytts/?${encodeURI(document.querySelector('#text').value).replaceAll('#', '%23').replaceAll('&', '%26')}&${document.querySelector('input[name="speed"]:checked').value == "other" ? document.querySelector('#speed').value.replaceAll('&', '%26') : document.querySelector('input[name="speed"]:checked').value}&${document.querySelector('input[name="pitch"]:checked').value == "other" ? document.querySelector('#pitch').value.replaceAll('&', '%26') : document.querySelector('input[name="pitch"]:checked').value}&${document.querySelector('input[name="voice"]:checked').value == "other" ? document.querySelector('#voice').value.replaceAll('&', '%26') : document.querySelector('input[name="voice"]:checked').value}`)
            alert('해당 기능은 실험 중인 기능입니다\n이상한거 입력하면 제대로 안 불러와지니 주의해주세요\n(허용되지 않는 문자 : %26(&으로 바뀜))')
        }
        function otherinput(par) {
            document.querySelectorAll('input[value="other"]')[par].click()
        }
        window.onload = () => {
            if (location.href.indexOf('?') != -1) {
                urlsplit = location.href.split('?')[1].split('&')
                if (/^-?[0-5]$/.test(urlsplit[1])) {
                    document.querySelector(`input[value="${urlsplit[1]}"]`).click()
                } else {
                    document.querySelectorAll(`input[value='other']`)[0].click()
                    document.querySelector(`#speed`).value = decodeURI(urlsplit[1]).replaceAll('%26', '&')
                }
                if (/^-?[0-5]$/.test(urlsplit[2])) {
                    document.querySelector(`input[id="${urlsplit[2]}"]`).click()
                } else {
                    document.querySelectorAll(`input[value='other']`)[2].click()
                    document.querySelector(`#pitch`).value = decodeURI(urlsplit[2].replaceAll('%26', '&'))
                }
                if (urlsplit[3] == "kyuri" || urlsplit[3] == "jinho" || urlsplit[3] == "hana" || urlsplit[3] == "dinna" || urlsplit[3] == "brown" || urlsplit[3] == "minions" || urlsplit[3] == "sally" || urlsplit[3] == "nsabina" || urlsplit[3] == "nmammon" || urlsplit[3] == "nmeow" || urlsplit[3] == "nwoof") {
                    document.querySelector(`input[value="${urlsplit[3]}"]`).click()
                } else {
                    document.querySelectorAll(`input[value='other']`)[1].click()
                    document.querySelector(`#voice`).value = decodeURI(urlsplit[3]).replaceAll('%26', '&')
                }
                document.querySelector(`#text`).value = decodeURI(urlsplit[0]).replaceAll('%23', "#").replaceAll('%26', "&")
                gen()
            }
        }
    </script>
</body>

</html>
